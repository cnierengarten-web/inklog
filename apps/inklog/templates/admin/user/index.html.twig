{% extends 'admin/base.html.twig' %}

{% block title %}Gestion des utilisateurs{% endblock %}
{% block content_title %}Gestion des utilisateurs{% endblock %}

{% block content %}
<a class="btn btn-outline-primary mt-4 mb-4" href="{{ path('admin_user_new') }}">
    <svg class="bi pe-none me-2" width="16" height="16" aria-hidden="true">
        <use href="{{ bi }}#plus-square-fill"></use>
    </svg>
    Créer un nouvel utilisateur
</a>
<div class="table-responsive small">
    <table class="table table-striped table-sm align-middle">
        <thead>
        <tr>
            <th scope="col">Nom de l'utilisateur</th>
            <th scope="col">Email</th>
            <th scope="col">Roles</th>
            <th scope="col">Date de création</th>
            <th scope="col">Date de mise à jour</th>
            <th scope="col"></th>
            <th scope="col"></th>
        </tr>
        </thead>
        <tbody>
        {% for user in users %}
        <tr>
            <td>{{ user.username }}</td>
            <td>{{ user.email }}</td>
            <td>
                {% if is_granted_for_user(user,'ROLE_SUPER_ADMIN') %}
                    Super Admin
                {% elseif is_granted_for_user(user, 'ROLE_ADMIN') %}
                    Admin
                {% else %}
                    Utilisateur
                {% endif %}
            <td>{{ user.createdAt|date('d/m/Y H:i') }}</td>
            <td>{{ user.updatedAt|date('d/m/y H:i') }}</td>
            <td>
                <a href="{{ path('admin_user_edit', {id: user.id}) }}" class="btn btn-link">
                    Editer
                </a>
            </td>
            <td>
                {% if (app.user().id is not same as user.id) and (not is_granted_for_user(user, 'ROLE_SUPER_ADMIN')) %}
                    <form action="{{ url('admin_user_delete', { id: user.id }) }}"
                          method="post"
                          class="d-inline mb-0"
                    >
                        <input type="hidden" name="_method" value="DELETE"/>
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}"/>
                        <button type="submit"
                                class="btn btn-link"
                                onclick="return confirm('Supprimer l\'utilisateur {{ user.username }}?');">
                            Supprimer
                        </button>
                    </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
